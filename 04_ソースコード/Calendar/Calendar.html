<?php
    if(!isset($_SESSION)){
        session_start();
    }
    require_once '../DBManager/DBAccess.php';
    $cls = new DBAccess();
    if(isset($_SESSION['user_id'])){
        $user_id = $_SESSION['user_id'];
    }else{
        header('Location: ../Login/Login.html', true, 307);
    }
    $Calendar = $cls->SelectCalendarTblByUserId($_SESSION['user_id']);
?>
<!DOCTYPE html>
<html lang="ja">
    <head>

        <meta charset="UTF-8">
        <title></title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <meta name="description" content="ここにサイト説明を入れます">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
        <link rel="manifest" href="../manifest.json">
        <link rel="stylesheet" href="./css/Calendar.css">
        <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
        <script>
            window.OneSignalDeferred = window.OneSignalDeferred || [];
            OneSignalDeferred.push(async function(OneSignal) {
                await OneSignal.init({
                    appId: "6e8a7b28-bfdf-4db5-9cc4-e43213398d68",
                });
                OneSignal.Notifications.setDefaultTitle("Powered by OneSignal!");
                let customUserId = "<?php echo $user_id?>";
                
                OneSignal.User.addAlias("external_id", customUserId);
                OneSignal.login(customUserId);
            });
            user_id = <?php echo $user_id;?>;
        </script>
    </head>
    <body>
        <main>
            <!-- ↓ ヘッダー読み込み ↓ -->
            <?php include("../Common/Header.html");?>
            <!-- ↑ ヘッダー読み込み ↑ -->
            <div id="calendar_main">
                    <?php
                    foreach($Calendar as $row){
                        if($row['registration_status'] == 1){
                            $dateOnly = date('Y年m月d日', strtotime($row['end_datetime']));
                            if(date('Y年m月d日') == $dateOnly){
                                echo '<div class="calendar2">';
                            }else{
                                echo '<div class="calendar">';
                                
                            }
                                echo $dateOnly." ".$row['title'];
                                echo '</div>';
                        }
                   } 
                   ?>
            </div>
            <!-- ↓ フッター読み込み ↓ -->
            <?php include("../Common/Footer.html");?>
            <!-- ↑ フッター読み込み ↑ -->
            <script>
            
                if ('serviceWorker' in navigator) {
    
    
                    navigator.serviceWorker.register('../sw.js').then(function() {
    
    
                        console.log('サービスワーカーの登録成功');
    
    
                    }).catch(function(err) {
    
    
                        console.log('サービスワーカーの登録ができませんでした：', err);
    
    
                    });
    
    
                }
            </script>
            <script src=""></script>
        </main>
    </body>
</html>